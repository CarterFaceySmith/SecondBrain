Compilers and [[Assemblers]] create object files containing generated [[Computer Binary]] code and data from a source file, these are then combined by [[Linkers]] into one, loaders take object files and load them into memory.

Refer also to [[Executable and Linkable Format (ELF) Files]].

## What Does It Contain Generally?

- **Header information**: Overall information about the file, such as the size of the code, name of the source file it was translated from, and creation date.
- **Object code**: Binary instructions and data generated by a compiler or assembler.
- **Relocation**: A list of the places in the object code that have to be fixed up when the linker changes the addresses of the object code.
- **Symbols**: Global symbols defined in this module, symbols to be imported from other modules or defined by the linker.
- **Debugging information**: Other information about the object code not needed for linking but of use to a debugger. This includes source file and line number information, local symbols, descriptions of data structures used by the object code such as C structure definitions.

Note that not all object file formats contain all this info.

## Designing Object Files

Driven by use and the system's runtime environment, an object file can be *linkable*, *executable*, *loadable*, or some combination of the three.

> There is some conflict among these applications. The logically oriented grouping of linkable segments rarely matches the hardware oriented grouping of executable segments. Particularly on smaller computers, linkable files are read and written by the linker a piece at a time, while executable files are loaded in their entirely into main memory. (*Linkers & Loaders*, p.60 - John R. Levine)

### Formats

#### Null Object Format: MS-DOS .COM Files

Consists of nothing other than [[Computer Binary]] code.

When run by the [[Operating Systems]] the OS simply:
1. Loads the contents of the file into a chunk of free memory starting at offset 0x100.
2. Sets the [[x86]] segment registers all to point to the PSP (Program Segment Prefix with CLI arguments and other parameters).
3. Sets the SP (stack pointer) register to the end of the segment since the stack grows downward.
4. Jumps to the beginning of the loaded program.

This is made possible by the segmented architecture of the [[x86]], all program addresses are interpreted relative to the base of the current segment, and all segment registers point to the base of the segment. Since the program is always loaded at segment-relative location 0x100 no changes are needed for a program that fits in a single segment. 

***If it doesn't fit it's the programmer's problem.***

#### Code Sections: Unix a.out Files

Computers with hardware memory [[Relocation]] usually create new processes with an empty address space for each newly run program, enabling them to be linked to start at a fixed address and require no [[Relocation]] at load time. This is what the a.out format helps with.

At simplest, an a.out file has a small `header` followed by executable code (called the `text` section) and the initial values for static data. Normally this is followed by a `data` and `other` section.

##### a.out Headers

Varies from one version of [[UNIX]] to another, but generally:
```
int a_magic; // magic number, indicates what sort of executable it is
int a_text; // text segment size in bytes of read-only code
int a_data; // initialized data size in bytes of read-write data
int a_bss; // uninitialized data size that follows in the file
int a_syms; // symbol table size that follows in the file
int a_entry; // entry point, starting address of program
int a_trsize; // text relocation size that follows in the file
int a_drsize; // data relocation size that follows in the file
```

#### Relocation: MS-DOS EXE Files

x

### Further Formats: Linkable Files

#### Relocatable a.out

`a.out` includes a relocation entry which marks the places in code to be modified when a section of code is relocated, in a linkable file this also marks references to undefined symbols so the [[Linkers]] knows where to patch in the symbol's value when it is finally defined.

#### [[Executable and Linkable Format (ELF) Files]]

An executable ELF file has the same general format as a relocatable ELF file but the data are arranged so that the file can be mapped into memory and run.




See also:
- [[Linkers and Loaders]]
- [[Computer Science Fundamentals]]
- [[Compilation]]
- [[Assemblers]]